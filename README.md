# RAGL

RAGL (RAG like Lego) — веб-платформа для сборки, тестирования и сравнения Retrieval-Augmented Generation (RAG) пайплайнов на локальной машине.

Проект рассчитан на сценарий "одна машина — один проект": документы загружаются в backend, индекс строится локально, запросы выполняются через выбранную LLM, результаты прогонов сохраняются в SQLite.

## Содержание

- [Назначение](#назначение)
- [Архитектура](#архитектура)
- [Требования](#требования)
- [Установка и запуск](#установка-и-запуск)
- [Конфигурация](#конфигурация)
- [Модели по умолчанию](#модели-по-умолчанию)
- [Работа в интерфейсе](#работа-в-интерфейсе)
- [Данные и артефакты](#данные-и-артефакты)
- [Структура репозитория](#структура-репозитория)

## Назначение

Приложение предназначено для быстрой сборки RAG-конфигураций и проверки качества на собственных документах и наборах вопросов:

- собрать пайплайн из стандартных блоков (разбиение, поиск, rerank, генерация);
- построить индекс;
- выполнить интерактивные запросы и посмотреть источники;
- прогнать бенчмарк и сравнить результаты в Insights.

Поддерживаемые форматы документов (без OCR): TXT, PDF (текстовый), DOCX, HTML, MD, CSV.

## Архитектура

- **Backend**: FastAPI + SQLModel/SQLite, RAG-движок, хранение документов/индексов/результатов.
- **Frontend**: Vite + React, конструктор пайплайнов (ReactFlow) и визуализация метрик (Recharts).
- **Модели**: HuggingFace Transformers для генерации, SentenceTransformers для эмбеддингов, BM25 (rank-bm25), опционально FAISS и CrossEncoder rerank.

## Требования

- Python 3.10+
- Node.js 18+

## Установка и запуск

Ниже приведены команды для запуска в режиме разработки.

### Backend (FastAPI)

```bash
cd backend

python -m venv .venv

# Windows
.venv\Scripts\activate

# macOS/Linux
source .venv/bin/activate

pip install -r requirements.txt

uvicorn app.main:app --reload --port 8000
```

Проверка:

- `http://localhost:8000/health`
- `http://localhost:8000/api/status`

### Frontend (React)

Во втором терминале:

```bash
cd frontend
npm install
npm run dev
```

Открыть:

- `http://localhost:5173`

## Конфигурация

Backend читает переменные окружения с префиксом `RAG_ARCH_` (файл `backend/.env` поддерживается).

Параметры:

- `RAG_ARCH_DATA_DIR` — директория для хранения документов, индексов и отчетов (по умолчанию `backend/data`).
- `RAG_ARCH_CORS_ORIGINS` — список origin через запятую (по умолчанию `http://localhost:5173`).
- `RAG_ARCH_DEFAULT_EMBED_MODEL` — дефолтная embedding-модель.
- `RAG_ARCH_DEFAULT_RERANK_MODEL` — дефолтный reranker.
- `RAG_ARCH_DEFAULT_LLM_MODEL` — дефолтная LLM.

Пример `backend/.env`:

```env
RAG_ARCH_CORS_ORIGINS=http://localhost:5173
# RAG_ARCH_DATA_DIR=./data
```

## Модели по умолчанию

Дефолты подобраны так, чтобы корректно работать с русским и английским контентом без дополнительной настройки:

- Embeddings: `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2`
- Rerank: `cross-encoder/mmarco-mMiniLMv2-L12-H384-v1`
- LLM: `Qwen/Qwen2.5-0.5B-Instruct`

При первом запуске модели скачиваются из HuggingFace и кэшируются. Кэш по умолчанию находится в `backend/data/hf_home` (переменная `HF_HOME` выставляется в `app.main`).

## Работа в интерфейсе

Рекомендуемая последовательность действий:

1. **Data Studio**: загрузите документы и (при необходимости) создайте набор вопросов (dataset).
2. **Architect**: выберите шаблон пайплайна и настройте параметры узлов.
3. **Build Index**: выполните построение индекса для выбранного пайплайна.
4. **The Lab**: проверьте ответы, источники и тайминги.
5. **Benchmark**: запустите прогон по выбранному dataset.
6. **Insights**: сравните результаты прогонов.

Примечание: при смене embedding-модели или параметров индексирования индекс требуется пересобрать.

## Данные и артефакты

По умолчанию все артефакты лежат в `backend/data/`:

- загруженные документы и извлеченный текст;
- индексы;
- результаты прогонов;
- кэш HuggingFace (`hf_home`).



## Структура репозитория

```text
rag-architect/
  backend/        FastAPI + RAG engine
  frontend/       React UI
  scripts/        вспомогательные скрипты
```
